# Energy Management Solution Overview

## Architecture Summary
- **Traefik** terminates HTTP traffic, applies path-based routing (/auth, /users, /devices) using Docker labels.
- Three Spring Boot microservices expose REST APIs and manage their own PostgreSQL schema/databases.
- Services communicate over REST. The User Service calls the Device Service to enrich /users/{id}/devices responses.
- JWT tokens issued by the Auth Service secure all downstream APIs. Tokens embed the credential id (uid) and role claim.
- Docker Compose orchestrates the entire stack for local development/testing.

## Microservices
| Service | Port | Responsibilities | Key Tech |
| --- | --- | --- | --- |
| Auth Service | 8081 | Register/login users, hash credentials, issue/validate JWT, expose /auth/me | Spring Security, BCrypt, JPA |
| User Service | 8082 | CRUD for user profiles (address/phone/etc.), expose /users/* & device aggregation endpoints | Spring Data JPA, RestTemplate |
| Device Service | 8083 | CRUD for energy devices, assign/unassign to users, expose owner queries | Spring Data JPA |

## Persistence
| Service | Table | Notes |
| --- | --- | --- |
| Auth | credentials | Username unique, BCrypt hashed passwords. |
| User | user_profiles | Profile id matches credential id, stores contact/address data. |
| Device | devices | Owner id references user_profiles.id. |

## Security
- JWT secret configurable via JWT_SECRET env var; expiration default 3600s.
- Auth endpoints /auth/login, /auth/register, /auth/validate are public.
- User/Device CRUD endpoints require ROLE_ADMIN; client-facing endpoints restrict data to the authenticated owner.
- Traefik acts purely as router; per-service Spring Security enforces authorization logic.

## Documentation & Tooling
- SpringDoc Swagger UI available at /swagger-ui.html for each service (proxied through Traefik).
- PlantUML deployment diagram: docs/deployment-diagram.puml.
- Example PostgreSQL schema files live under db/*.sql for quick bootstrap/testing.

## Build & Run Highlights
1. docker compose build
2. docker compose up -d
3. Access Traefik at http://localhost.
4. Create an admin credential via POST /auth/register (role ADMIN), then log in to obtain JWT for admin tasks.
5. Use JWT to create user profiles and devices, assign devices, and validate role-based behaviours.

Refer to the root README.md for the detailed step-by-step guide, environment variables, and endpoint tables.
